syntax = "proto3";
option go_package = "github.com/jaggerzhuang1994/kratos-foundation/proto/kratos_foundation_pb/config_pb";

package kratos_foundation_pb;

import "pubg/jsonschema.proto";

message Log {
  // 最小日志级别 (本地环境或者debug环境默认 debug，其他环境默认 info)
  optional string level = 1 [(pubg.jsonschema.field) = {string: {enum: ['debug', 'DEBUG', 'info', 'INFO', 'warn', 'WARN', 'error', 'ERROR']}}];
  // 是否过滤掉空值的kv(默认true)
  optional bool filter_empty = 2;
  // 打印日志过滤哪些keys
  repeated string filter_keys = 3;
  // 时间格式化 默认为 time.RFC3339
  optional string time_format = 4;
  // 标准输出流日志
  optional StdLogger std = 5;
  // 文件日志
  optional FileLogger file = 6;
  // 预置哪些 kv，默认 ts, service.id, service.name, service.version, trace.id, span.id, caller
  repeated string preset = 7 [(pubg.jsonschema.field) = {string: {enum: ['ts', 'service.id', 'service.name', 'service.version', 'trace.id', 'span.id', 'caller']}}];
}

message StdLogger {
  // 是否禁用std logger
  optional bool disable = 1;
  // 最小日志级别（默认值为父级level）
  optional string level = 2 [(pubg.jsonschema.field) = {string: {enum: ['debug', 'DEBUG', 'info', 'INFO', 'warn', 'WARN', 'error', 'ERROR']}}];
  // 打印日志过滤哪些keys（默认值为 service.id, service.name, service.version）
  repeated string filter_keys = 3;
}

message FileLogger {
  // 是否禁用file logger
  optional bool disable = 1;
  // 最小日志级别（默认值为父级level）
  optional string level = 2 [(pubg.jsonschema.field) = {string: {enum: ['debug', 'DEBUG', 'info', 'INFO', 'warn', 'WARN', 'error', 'ERROR']}}];
  // 打印日志过滤哪些keys
  repeated string filter_keys = 3;
  // 日志路径 (默认 ./app.log)
  optional string path = 4;
  // 文件拆分
  optional FileRotating rotating = 5;
}

message FileRotating {
  // 禁用文件拆分(默认不禁用)
  optional bool disable = 1;
  // 日志文件在轮转前允许的最大大小。默认为 100 MB。
  optional int64 max_size = 2;
  // 是根据备份文件名中编码的时间戳来保留旧日志文件的最大天数。
  // 注意：一天被定义为 24 小时，可能与日历中的自然日不完全对应，
  // 比如受到夏令时、闰秒等影响。默认不会因为时间而删除旧日志文件。
  // 默认会保留所有文件。
  optional int32 max_file_age = 3;
  // 要保留的旧日志文件的最大数量。
  // 默认会保留所有旧日志文件（但 MaxAge 仍可能导致旧文件被删除）。
  optional int32 max_files = 4;
  // 决定备份文件名中的时间戳是否使用本地时间。默认使用 UTC 时间。
  optional bool local_time = 5;
  // 决定轮转后的日志文件是否使用 gzip 压缩。默认不压缩。
  optional bool compress = 6;
}
