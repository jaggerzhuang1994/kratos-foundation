// Code generated by protoc-gen-kratos-foundation-client. DO NOT EDIT.
// versions:
// - protoc-gen-kratos-foundation-client {{.ProtocGenGoClientRelease}}
// - protoc               {{.ProtocVersion}}
{{- if .Deprecated}}
// {{.Path}} is a deprecated file.
{{- else}}
// source: {{.Path}}
{{- end}}
package {{.GoPackageName}}

{{- range .Services}}

{{$fileServiceName := .File.ServiceName}}

// wire providers

// {{.ServiceName}}Provider .
var {{.ServiceName}}Provider = wire.NewSet(
	New{{.ServiceName}}ClientImpl,
)

// service interface

// {{.ServiceName}} .
{{- if .Deprecated}}
// Deprecated: Do not use.
{{- end}}
type {{.ServiceName}} interface {
{{- range .MethodSets}}
    {{.Comment}}
	{{.Name}}(context.Context, *{{.Request}}) (*{{.Reply}}, error)
{{- end}}
}

// service client impl

type {{.ServiceName}}ClientImpl struct {
	factory *client.Factory
}

func New{{.ServiceName}}ClientImpl(factory *client.Factory) {{.ServiceName}} {
	return &{{.ServiceName}}ClientImpl{factory}
}

{{range .MethodSets}}
func (c *{{.ServiceName}}ClientImpl) {{.Name}}(ctx context.Context, in *{{.Request}}) (rsp *{{.Reply}}, err error) {
	ctx = client.WithDefaultConnName(ctx, "{{$fileServiceName}}")

	// 获取连接
	httpClient, grpcClient, err := c.factory.ResolveClient(ctx)
	if err != nil {
		return nil, errors.WithMessagef(err, "resolve %s client err", client.ConnNameFromContext(ctx))
	}

	// 发起请求
	if grpcClient != nil {
		opts := client.GrpcCallOptionFromContext(ctx)
		rsp, err = New{{.ServiceName}}Client(grpcClient).{{.Name}}(ctx, in, opts...)
	} else {
		opts := client.HttpCallOptionFromContext(ctx)
		rsp, err = New{{.ServiceName}}HTTPClient(httpClient).{{.Name}}(ctx, in, opts...)
	}
	return
}
{{end}}

{{- end}}
